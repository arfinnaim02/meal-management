{% extends "base.html" %}
{% block title %}Dashboard - Mess Meal Manager{% endblock %}
{% block content %}
<div class="max-w-6xl mx-auto space-y-6 mt-6 md:mt-0">
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-3">
    <div>
      <h1 class="text-2xl font-semibold text-slate-900">{{ mess.name }}</h1>
      <p class="text-sm text-slate-500">Month: {{ year }}-{{ month|stringformat:"02d" }}</p>
    </div>
    <form method="get" class="flex items-center gap-2 text-sm">
      <input type="number" name="month" min="1" max="12" value="{{ month }}" class="border rounded-lg px-3 py-2 w-20 bg-white" />
      <input type="number" name="year" value="{{ year }}" class="border rounded-lg px-3 py-2 w-24 bg-white" />
      <button type="submit" class="inline-flex items-center px-4 py-2 rounded-lg bg-slate-900 text-slate-50 text-sm font-medium hover:bg-slate-800">Go</button>
    </form>
  </div>
  <!-- Summary cards -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
      <p class="text-xs font-medium text-slate-500 uppercase">Meal Rate</p>
      <p class="mt-2 text-2xl font-semibold">à§³ {{ data.summary.meal_rate }}</p>
      <p class="mt-1 text-xs text-slate-400">Per meal this month</p>
    </div>
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
      <p class="text-xs font-medium text-slate-500 uppercase">Total Meals</p>
      <p class="mt-2 text-2xl font-semibold">{{ data.summary.total_meals }}</p>
      <p class="mt-1 text-xs text-slate-400">All active members</p>
    </div>
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
      <p class="text-xs font-medium text-slate-500 uppercase">Total Expense</p>
      <p class="mt-2 text-2xl font-semibold">à§³ {{ data.summary.total_expense }}</p>
      <p class="mt-1 text-xs text-slate-400">Meal bazar this month</p>
    </div>
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
      <p class="text-xs font-medium text-slate-500 uppercase">Total Collected</p>
      <p class="mt-2 text-2xl font-semibold">à§³ {{ data.summary.total_collected }}</p>
      <p class="mt-1 text-xs text-slate-400">Deposits from members</p>
    </div>
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
      <p class="text-xs font-medium text-slate-500 uppercase">Mess Balance</p>
      {% if data.summary.mess_balance >= 0 %}
      <p class="mt-2 text-2xl font-semibold text-emerald-600">+à§³ {{ data.summary.mess_balance }}</p>
      <p class="mt-1 text-xs text-emerald-500">Advance in mess fund</p>
      {% else %}
      <p class="mt-2 text-2xl font-semibold text-rose-600">à§³ {{ data.summary.mess_balance }}</p>
      <p class="mt-1 text-xs text-rose-500">Mess is running on due</p>
      {% endif %}
    </div>
    <div class="bg-white rounded-2xl shadow-sm border border-slate-100 p-4">
      <p class="text-xs font-medium text-slate-500 uppercase">Members &amp; Breakfast</p>
      <p class="mt-2 text-lg font-semibold">{{ data.summary.active_members }} members</p>
      <p class="mt-1 text-xs text-slate-400">Breakfast:
        {% if data.summary.include_breakfast %}
        Included ({{ data.summary.breakfast_weight }} meal)
        {% else %}
        Not included
        {% endif %}
      </p>
    </div>
  </div>
  <!-- Quick actions -->
  <div class="flex flex-wrap gap-3 mt-2">
    <a href="{% url 'core:meals_add' %}" class="inline-flex items-center px-4 py-2 rounded-xl bg-slate-900 text-slate-50 text-sm font-medium hover:bg-slate-800">+ Add Meals</a>
    {% if user_is_super_admin %}
    <a href="{% url 'core:expense_add' %}" class="inline-flex items-center px-4 py-2 rounded-xl bg-white border border-slate-200 text-sm font-medium hover:bg-slate-50">+ Add Expense</a>
    <a href="{% url 'core:deposit_add' %}" class="inline-flex items-center px-4 py-2 rounded-xl bg-white border border-slate-200 text-sm font-medium hover:bg-slate-50">+ Add Deposit</a>
    <a href="{% url 'core:manager_assignments' %}" class="inline-flex items-center px-4 py-2 rounded-xl bg-amber-50 text-amber-800 text-sm font-medium border border-amber-200 hover:bg-amber-100">âš™ Manage Meal Managers</a>
    <a href="{% url 'core:members' %}" class="inline-flex items-center px-4 py-2 rounded-xl bg-indigo-50 text-indigo-800 text-sm font-medium border border-indigo-200 hover:bg-indigo-100">ðŸ‘¥ Members</a>
    <a href="{% url 'core:settings' %}" class="inline-flex items-center px-4 py-2 rounded-xl bg-cyan-50 text-cyan-800 text-sm font-medium border border-cyan-200 hover:bg-cyan-100">âš™ Settings</a>
    {% endif %}
  </div>
  <!-- Member finances table -->
  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 mt-4">
    <div class="px-4 py-3 border-b border-slate-100 flex items-center justify-between">
      <h2 class="text-sm font-semibold text-slate-700">Member Balances</h2>
      <p class="text-xs text-slate-400">Who has due &amp; who has advance</p>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50 text-slate-500 text-xs uppercase">
          <tr>
            <th class="px-4 py-2 text-left">Member</th>
            <th class="px-4 py-2 text-right">Meals</th>
            <th class="px-4 py-2 text-right">Meal Cost</th>
            <th class="px-4 py-2 text-right">Deposited</th>
            <th class="px-4 py-2 text-right">Net</th>
            <th class="px-4 py-2 text-center">Status</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for m in data.members %}
          <tr>
            <td class="px-4 py-2">{{ m.name }}</td>
            <td class="px-4 py-2 text-right">{{ m.meals }}</td>
            <td class="px-4 py-2 text-right">à§³ {{ m.meal_cost }}</td>
            <td class="px-4 py-2 text-right">à§³ {{ m.deposited }}</td>
            <td class="px-4 py-2 text-right">
              {% if m.net < 0 %}
                <span class="text-rose-600">à§³ {{ m.net }}</span>
              {% elif m.net > 0 %}
                <span class="text-emerald-600">+à§³ {{ m.net }}</span>
              {% else %}
                à§³ 0
              {% endif %}
            </td>
            <td class="px-4 py-2 text-center">
              {% if m.status == 'due' %}
              <span class="inline-flex px-2 py-1 rounded-full text-xs bg-rose-50 text-rose-700">Due</span>
              {% elif m.status == 'advance' %}
              <span class="inline-flex px-2 py-1 rounded-full text-xs bg-emerald-50 text-emerald-700">Advance</span>
              {% else %}
              <span class="inline-flex px-2 py-1 rounded-full text-xs bg-slate-100 text-slate-600">Settled</span>
              {% endif %}
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="px-4 py-4 text-center text-sm text-slate-400">No data yet. Add meals, expenses and deposits to see the summary.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  <!-- Manager stats -->
  {% if manager_stats %}
  <div class="bg-white rounded-2xl shadow-sm border border-slate-100 mt-4">
    <div class="px-4 py-3 border-b border-slate-100 flex items-center justify-between">
      <h2 class="text-sm font-semibold text-slate-700">Meal Manager Duty Stats</h2>
      <p class="text-xs text-slate-400">How many days each member managed meals</p>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-sm">
        <thead class="bg-slate-50 text-slate-500 text-xs uppercase">
          <tr>
            <th class="px-4 py-2 text-left">Manager</th>
            <th class="px-4 py-2 text-right">Total Days Managed</th>
            <th class="px-4 py-2 text-right">Assignments</th>
            <th class="px-4 py-2 text-left">Last Period</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-slate-100">
          {% for row in manager_stats %}
          <tr>
            <td class="px-4 py-2">{{ row.name }}</td>
            <td class="px-4 py-2 text-right">{{ row.total_days }}</td>
            <td class="px-4 py-2 text-right">{{ row.assignment_count }}</td>
            <td class="px-4 py-2 text-left">{{ row.last_start }} â†’ {{ row.last_end }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
  {% endif %}
</div>
{% endblock %}
